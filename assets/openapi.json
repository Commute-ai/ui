{"openapi":"3.1.0","info":{"title":"Commute.ai","description":"AI-powered public transport routing","version":"1.0.0"},"paths":{"/api/v1/health":{"get":{"tags":["health"],"summary":"Health Check","description":"Comprehensive health check endpoint that verifies:\n- Database connectivity\n- HSL API availability\n- AI-agents API availability\n\nReturns 200 if all services are healthy, 503 if any service is down.","operationId":"health_check_api_v1_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthCheckResponse"}}}}}}},"/api/v1/auth/register":{"post":{"tags":["auth"],"summary":"Register User","description":"Register a new user.","operationId":"register_user_api_v1_auth_register_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserCreate"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/auth/login":{"post":{"tags":["auth"],"summary":"Login For Access Token","description":"OAuth2 compatible token login, get an access token for future requests.","operationId":"login_for_access_token_api_v1_auth_login_post","requestBody":{"content":{"application/x-www-form-urlencoded":{"schema":{"$ref":"#/components/schemas/Body_login_for_access_token_api_v1_auth_login_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Token"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/users/me":{"get":{"tags":["users"],"summary":"Read Current User","description":"Get current user.","operationId":"read_current_user_api_v1_users_me_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/UserResponse"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/v1/users/preferences":{"get":{"tags":["preferences"],"summary":"Get User Preferences","description":"Get all global preferences for the authenticated user.","operationId":"get_user_preferences_api_v1_users_preferences_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/GlobalPreferenceResponse"},"type":"array","title":"Response Get User Preferences Api V1 Users Preferences Get"}}}}},"security":[{"OAuth2PasswordBearer":[]}]},"post":{"tags":["preferences"],"summary":"Create Preference","description":"Create a new global preference for the authenticated user.","operationId":"create_preference_api_v1_users_preferences_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GlobalPreferenceCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/GlobalPreferenceResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/v1/users/preferences/{preference_id}":{"delete":{"tags":["preferences"],"summary":"Delete Preference","description":"Delete a global preference for the authenticated user.","operationId":"delete_preference_api_v1_users_preferences__preference_id__delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"preference_id","in":"path","required":true,"schema":{"type":"integer","title":"Preference Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/users/route-preferences":{"get":{"tags":["route-preferences"],"summary":"Get User Route Preferences","description":"Get all route preferences for the authenticated user.","operationId":"get_user_route_preferences_api_v1_users_route_preferences_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"items":{"$ref":"#/components/schemas/RoutePreferenceResponse"},"type":"array","title":"Response Get User Route Preferences Api V1 Users Route Preferences Get"}}}}},"security":[{"OAuth2PasswordBearer":[]}]},"post":{"tags":["route-preferences"],"summary":"Create Route Preference","description":"Create a new route preference for the authenticated user.","operationId":"create_route_preference_api_v1_users_route_preferences_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoutePreferenceCreate"}}},"required":true},"responses":{"201":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RoutePreferenceResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/api/v1/users/route-preferences/{preference_id}":{"delete":{"tags":["route-preferences"],"summary":"Delete Route Preference","description":"Delete a route preference for the authenticated user.","operationId":"delete_route_preference_api_v1_users_route_preferences__preference_id__delete","security":[{"OAuth2PasswordBearer":[]}],"parameters":[{"name":"preference_id","in":"path","required":true,"schema":{"type":"integer","title":"Preference Id"}}],"responses":{"204":{"description":"Successful Response"},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/v1/routes/search":{"post":{"tags":["routes"],"summary":"Search Routes","description":"Search for public transport routes between two locations.\n\nQueries the HSL (Helsinki Regional Transport) API to find route alternatives\nbetween origin and destination coordinates. Requires authentication.\n\nArgs:\n    request: Route search parameters including origin, destination, and preferences\n    db: Database session\n    current_user: Authenticated user (required)\n\nReturns:\n    RouteSearchResponse with list of available route itineraries\n\nRaises:\n    HTTPException: If the route search fails or returns invalid data","operationId":"search_routes_api_v1_routes_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/RouteSearchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/RouteSearchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}},"security":[{"OAuth2PasswordBearer":[]}]}},"/":{"get":{"summary":"Read Root","operationId":"read_root__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}}},"components":{"schemas":{"Body_login_for_access_token_api_v1_auth_login_post":{"properties":{"grant_type":{"anyOf":[{"type":"string","pattern":"^password$"},{"type":"null"}],"title":"Grant Type"},"username":{"type":"string","title":"Username"},"password":{"type":"string","format":"password","title":"Password"},"scope":{"type":"string","title":"Scope","default":""},"client_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Client Id"},"client_secret":{"anyOf":[{"type":"string"},{"type":"null"}],"format":"password","title":"Client Secret"}},"type":"object","required":["username","password"],"title":"Body_login_for_access_token_api_v1_auth_login_post"},"Coordinates":{"properties":{"latitude":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"Latitude","description":"Latitude in decimal degrees"},"longitude":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"Longitude","description":"Longitude in decimal degrees"}},"type":"object","required":["latitude","longitude"],"title":"Coordinates","description":"Geographic coordinates (latitude and longitude)."},"GlobalPreferenceCreate":{"properties":{"prompt":{"type":"string","title":"Prompt"}},"type":"object","required":["prompt"],"title":"GlobalPreferenceCreate"},"GlobalPreferenceResponse":{"properties":{"prompt":{"type":"string","title":"Prompt"},"id":{"type":"integer","title":"Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["prompt","id","created_at"],"title":"GlobalPreferenceResponse"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthCheckResponse":{"properties":{"service":{"type":"string","title":"Service"},"version":{"type":"string","title":"Version"},"timestamp":{"type":"string","title":"Timestamp"},"healthy":{"type":"boolean","title":"Healthy"},"database":{"$ref":"#/components/schemas/ServiceHealth"},"routing_service":{"$ref":"#/components/schemas/ServiceHealth"},"ai_agents_service":{"$ref":"#/components/schemas/ServiceHealth"}},"type":"object","required":["service","version","timestamp","healthy","database","routing_service","ai_agents_service"],"title":"HealthCheckResponse"},"Itinerary":{"properties":{"start":{"type":"string","format":"date-time","title":"Start"},"end":{"type":"string","format":"date-time","title":"End"},"duration":{"type":"integer","title":"Duration","description":"Total duration in seconds"},"walk_distance":{"type":"number","title":"Walk Distance","description":"Total walking distance in meters"},"walk_time":{"type":"integer","title":"Walk Time","description":"Total walking time in seconds"},"legs":{"items":{"$ref":"#/components/schemas/Leg"},"type":"array","title":"Legs"}},"type":"object","required":["start","end","duration","walk_distance","walk_time","legs"],"title":"Itinerary","description":"A complete journey from origin to destination."},"ItineraryWithInsight":{"properties":{"start":{"type":"string","format":"date-time","title":"Start"},"end":{"type":"string","format":"date-time","title":"End"},"duration":{"type":"integer","title":"Duration","description":"Total duration in seconds"},"walk_distance":{"type":"number","title":"Walk Distance","description":"Total walking distance in meters"},"walk_time":{"type":"integer","title":"Walk Time","description":"Total walking time in seconds"},"legs":{"items":{"$ref":"#/components/schemas/LegWithInsight"},"type":"array","title":"Legs"},"ai_insight":{"type":"string","title":"Ai Insight","description":"AI-generated insight about the itinerary"}},"type":"object","required":["start","end","duration","walk_distance","walk_time","legs","ai_insight"],"title":"ItineraryWithInsight","description":"A complete journey from origin to destination with AI insights."},"Leg":{"properties":{"mode":{"$ref":"#/components/schemas/TransportMode"},"start":{"type":"string","format":"date-time","title":"Start"},"end":{"type":"string","format":"date-time","title":"End"},"duration":{"type":"integer","title":"Duration","description":"Duration in seconds"},"distance":{"type":"number","title":"Distance","description":"Distance in meters"},"from_place":{"$ref":"#/components/schemas/Place"},"to_place":{"$ref":"#/components/schemas/Place"},"route":{"anyOf":[{"$ref":"#/components/schemas/Route"},{"type":"null"}]}},"type":"object","required":["mode","start","end","duration","distance","from_place","to_place"],"title":"Leg","description":"A single segment of a journey."},"LegWithInsight":{"properties":{"mode":{"$ref":"#/components/schemas/TransportMode"},"start":{"type":"string","format":"date-time","title":"Start"},"end":{"type":"string","format":"date-time","title":"End"},"duration":{"type":"integer","title":"Duration","description":"Duration in seconds"},"distance":{"type":"number","title":"Distance","description":"Distance in meters"},"from_place":{"$ref":"#/components/schemas/Place"},"to_place":{"$ref":"#/components/schemas/Place"},"route":{"anyOf":[{"$ref":"#/components/schemas/Route"},{"type":"null"}]},"ai_insight":{"type":"string","title":"Ai Insight","description":"AI-generated insight about the leg"}},"type":"object","required":["mode","start","end","duration","distance","from_place","to_place","ai_insight"],"title":"LegWithInsight","description":"A single segment of a journey with AI insight."},"Place":{"properties":{"coordinates":{"$ref":"#/components/schemas/Coordinates"},"name":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Name"}},"type":"object","required":["coordinates"],"title":"Place","description":"A place with metadata"},"Route":{"properties":{"short_name":{"type":"string","title":"Short Name","description":"Short name of the route, e.g., bus number"},"long_name":{"type":"string","title":"Long Name","description":"Long name of the route, e.g., full route name"},"description":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Description","description":"Description of the route"}},"type":"object","required":["short_name","long_name"],"title":"Route","description":"Route information for a leg of the journey."},"RoutePreferenceCreate":{"properties":{"prompt":{"type":"string","title":"Prompt"},"from_latitude":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"From Latitude"},"from_longitude":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"From Longitude"},"to_latitude":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"To Latitude"},"to_longitude":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"To Longitude"}},"type":"object","required":["prompt","from_latitude","from_longitude","to_latitude","to_longitude"],"title":"RoutePreferenceCreate"},"RoutePreferenceResponse":{"properties":{"prompt":{"type":"string","title":"Prompt"},"from_latitude":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"From Latitude"},"from_longitude":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"From Longitude"},"to_latitude":{"type":"number","maximum":90.0,"minimum":-90.0,"title":"To Latitude"},"to_longitude":{"type":"number","maximum":180.0,"minimum":-180.0,"title":"To Longitude"},"id":{"type":"integer","title":"Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["prompt","from_latitude","from_longitude","to_latitude","to_longitude","id","created_at"],"title":"RoutePreferenceResponse"},"RouteSearchRequest":{"properties":{"origin":{"$ref":"#/components/schemas/Coordinates","description":"Starting location coordinates"},"destination":{"$ref":"#/components/schemas/Coordinates","description":"Destination location coordinates"},"earliest_departure":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Earliest Departure","description":"Earliest departure time (ISO format). Defaults to current time if not provided."},"num_itineraries":{"type":"integer","maximum":10.0,"minimum":1.0,"title":"Num Itineraries","description":"Number of route alternatives to return (1-10, default: 3)","default":3},"preferences":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Preferences","description":"User preferences for route optimization (e.g., 'prefer walking', 'avoid buses')"}},"type":"object","required":["origin","destination"],"title":"RouteSearchRequest","description":"Request schema for route search endpoint."},"RouteSearchResponse":{"properties":{"origin":{"$ref":"#/components/schemas/Coordinates"},"destination":{"$ref":"#/components/schemas/Coordinates"},"itineraries":{"items":{"anyOf":[{"$ref":"#/components/schemas/Itinerary"},{"$ref":"#/components/schemas/ItineraryWithInsight"}]},"type":"array","title":"Itineraries","description":"List of route itineraries"},"search_time":{"type":"string","format":"date-time","title":"Search Time","description":"Time when the search was performed"}},"type":"object","required":["origin","destination","itineraries","search_time"],"title":"RouteSearchResponse","description":"Response schema for route search endpoint."},"ServiceHealth":{"properties":{"healthy":{"type":"boolean","title":"Healthy"},"message":{"type":"string","title":"Message"}},"type":"object","required":["healthy","message"],"title":"ServiceHealth"},"Token":{"properties":{"access_token":{"type":"string","title":"Access Token"},"token_type":{"type":"string","title":"Token Type"}},"type":"object","required":["access_token","token_type"],"title":"Token"},"TransportMode":{"type":"string","enum":["WALK","BICYCLE","CAR","TRAM","SUBWAY","RAIL","BUS","FERRY"],"title":"TransportMode","description":"Transport modes."},"UserCreate":{"properties":{"username":{"type":"string","title":"Username"},"password":{"type":"string","title":"Password"}},"type":"object","required":["username","password"],"title":"UserCreate"},"UserResponse":{"properties":{"username":{"type":"string","title":"Username"},"id":{"type":"integer","title":"Id"},"created_at":{"type":"string","format":"date-time","title":"Created At"},"updated_at":{"anyOf":[{"type":"string","format":"date-time"},{"type":"null"}],"title":"Updated At"}},"type":"object","required":["username","id","created_at"],"title":"UserResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}},"securitySchemes":{"OAuth2PasswordBearer":{"type":"oauth2","flows":{"password":{"scopes":{},"tokenUrl":"/api/v1/auth/login"}}}}}}